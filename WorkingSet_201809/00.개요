
###########
개요
###########

#이미지
-Centos7 : 아파치웹서버 빌드용, 이외 사용처는 아직 없음, only java나 tomcat은 도커 이미지 사용함
-httpd : 자체빌드함, 도커이미지는 구동계정과 볼륨연결 시 소유권 이슈가 있어 사용하지 않음
-tomcat : 도커이미지 사용함




*autoscale out 고려하지 않음

*yaml은 pod가 아닌 deployment 단위로 함
-그러므로 deployment에서 볼륨 정의하면 pod(기본 2개로 할거임)들이 동일한 경로와 동일한 파일을 공유하게 됨
-이때 CONFIG는 문제될 것 같지 않으나, 로그가 문제될 것으로 예상됨
-(옵션)향후 pilot 테스트 및 관리스킬이 올라가면 pod 단위로 볼륨할지 말지 결정함

*즉, 아파치 deployment 1개에 replica 2개 기본 셋팅이고
*톰캣 deployment 1개에 replica 2개 기본 셋팅임

*컨테이너 안에 모든 소스(html, jsp, war,,,) 패키징함

*컨테이너 밖으로 빼는 것은 주요 conf 파일과 로그파일(옵션)
-그러므로 conf파일은 공유됨 (아파치, 톰캣)
-conf 설정 변경 테스트는 A/B 배포로 함

*로그는 filebeat로 elasticsearc로 보냄

*그러나 실시간으로 로그보거나 쌓이는지는 확인할 필요가 있을 것이므로 외부 볼륨으로 빼기는 하나
일단 동일볼륨/동일파일에 쌓이게끔 해봄(왜냐 deployment 단위의 볼륨 구성이므로)

여차저차 안되면 예로 아파치 conf파일에서 파일명을 hostname(램덤임)으로 하던가 ,,,


###########
실행계획
###########

Docker Hub에서 아파치웹서버 다운로드 받아서 소폭의 수정을 적용한다.
-데비안 레포지토리 사이트 수정 (기존 것은 접속 안됨)
-그리고 net-toos설치
-prompt와 bk 쉘 등 설치


###########
Drop
###########

Docker Hub httpd image에 데몬 구동계정, 웹루트 소유권이 호스트서버와 상이하여
볼륨연결 시 모종의 작업을 해줘야 함. 이것이 불편하여,,, 아파치는 자체 제작한 것을 사용하기로 함



